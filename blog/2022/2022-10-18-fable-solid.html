<html class="has-navbar-fixed-top" lang="en"><head><title>Fable · Fable + Solid: React, the good parts with a performance boost</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item is-hidden-mobile" href="/packages/">Packages</a><a class="navbar-item is-hidden-mobile" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item is-hidden-mobile" href="/community.html">Community</a><a class="navbar-item is-hidden-mobile" href="/resources.html">Resources</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/packages/">Packages</a><a class="nacara-navbar-menu-item" href="/repl/">Try</a><a class="nacara-navbar-menu-item" href="/community.html">Community</a><a class="nacara-navbar-menu-item" href="/resources.html">Resources</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/fable">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a><a class="nacara-navbar-menu-item" href="https://gitter.im/fable-compiler/Fable">Gitter</a><a class="nacara-navbar-menu-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos">Youtube</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/alfonsogarciacaro.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Fable + Solid: React, the good parts with a performance boost</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://twitter.com/alfonsogcnunez">Alfonso García-Caro</a><span class="tag is-rounded is-medium">October 18, 2022</span></div><div class="content"><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtki{font-style:italic}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .mtk8{color:#0184bc}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk6{color:#986801}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .mtk7{color:#a0a1a7}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><p>When <a href=2022-06-06-Snake_Island_alpha.html>announcing Fable 4</a> we explained how the new JSX compilation target made Fable compatible with SolidJS. But what is SolidJS? The best way to answer this question is to <a href=https://www.solidjs.com/>check their website</a> but in short, it's a tool/library that allows you to write React-like apps, while taking advantage of the JSX compilation step to analyze the dependencies in your code and transform your declarative UI into imperative statements that make localized DOM updates, instead of using a Virtual DOM and calculate the diffing at runtime as React does.<p>This approach was popularized by <a href=https://svelte.dev/>Svelte</a> in the JS world, but it was also pioneered in F# by <a href=https://fsprojects.github.io/FSharp.Data.Adaptive/>FSharp.Adaptive</a> and <a href=https://sutil.dev/>Sutil</a>. Some of the advantages are:<ul><li>Better performance as the diffing is already done at compile time<li>Smaller bundle sizes because the framework doesn't need a big runtime<li>Components are "just functions" instead of instances in disguise</ul><p>The third point has some implications for performance, but the most important consequence is the code within the component will behave as you expect from a regular function. I think this is important for F# developers, as the community has sometimes struggled to understand (and explain) well the difference between functional components and "just" functions. With Solid, the code is only executed when the function is called during the program flow. Consider the following example:<pre class="atom-one-light grvsc-container"data-index=0 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60JSX.Component>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>Counter</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    printfn </span><span class=mtk10>"Evaluating function..."</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>count</span><span class=mtk14>,</span><span class=mtk1> setCount </span><span class=mtk14>=</span><span class=mtk1> Solid.createSignal </span><span class=mtk14>(</span><span class=mtk6>0</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    JSX.html $</span><span class=mtk10>"""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        &#60p>Count is {let _ = printfn "Evaluating expression..." in count()}&#60/p></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        &#60button class="button" onclick={fun _ -> count () + 1 |> setCount}></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>            Click me!</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        &#60/button></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60/></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    """</span></span></span></code></pre><p>The message appearing on the function root, "Evaluating function", is only printed once, while the local message, "Evaluating expression", is printed every time <code>count</code> gets updated. This means Solid has detected that, when <code>count</code> changes, it only needs to update the re-evaluate the expression in that particular JSX "hole", and it can leave the rest of the component untouched. And Solid is capable of doing this not only with the signal primitives, but also with props coming from a parent component or even an Elmish model!<blockquote><p>To be fair, there is still some magic involved, as you need to understand the expressions containing a reactive value will be re-evaluated every time the value changes.</blockquote><p>The UI in Solid apps looks very much like React ones, but you can choose between camelCase or "proper" attribute names, like <code>class</code> or <code>autofocus</code>. Another important difference is when declaring a <strong>dynamic list or conditional elements:</strong> in these cases Solid requires you to be explicit with <a href=https://www.solidjs.com/tutorial/flow_for>For</a> and <a href=https://www.solidjs.com/tutorial/flow_show>Show</a>/<a href=https://www.solidjs.com/tutorial/flow_switch>Switch</a> respectively. For helpers to create reactive values, effects and such, please check <a href=https://www.solidjs.com/docs/latest/api>Solid documentation</a> and <a href=https://github.com/fable-compiler/Fable.Solid/blob/master/src/Fable.Solid/Solid.fs>Fable.Solid</a> bindings.<pre class="atom-one-light grvsc-container"data-index=1 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// Note how `Solid.For` is used to display the list of Todos</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>model</span><span class=mtk14>,</span><span class=mtk1> dispatch </span><span class=mtk14>=</span><span class=mtk1> Solid.createElmishStore </span><span class=mtk14>(</span><span class=mtk1>init</span><span class=mtk14>,</span><span class=mtk1> update</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>JSX.jsx $</span><span class=mtk10>"""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>&#60></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60p class="title">To-Do List&#60/p></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    {InputField dispatch}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60ul>{Solid.For(model.Todos, (fun todo _ -> TodoView todo dispatch))}&#60/ul></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>&#60/></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>"""</span></span></span></code></pre><br><p>Solid is also compatible with <a href=https://developer.mozilla.org/en-US/docs/Web/Web_Components>Web Components</a>. So if you want to use a library like <a href=https://shoelace.style/>Shoelace</a>, you only need to register the components you need, and then invoke them as if they were native HTML elements. The only thing you need to remember is to prefix custom events with <code>on:</code><pre class="atom-one-light grvsc-container"data-index=2 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core.JsInterop</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60JSX.Component>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>ImageComparer</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// Cherry-pick Shoelace image comparer element, see https://shoelace.style/components/image-comparer</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    importSideEffects </span><span class=mtk10>"https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.73/dist/components/image-comparer/image-comparer.js"</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    JSX.html $</span><span class=mtk10>"""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60sl-image-comparer</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        position={position()}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        on:sl-change={fun (ev: Event) -> printfn "New position: </span><span class=mtk14>%i</span><span class=mtk10>" ev.target?position}></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        &#60img slot="before"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>            src="https://images.unsplash.com/photo-1520903074185-8eca362b3dce"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>            alt="A person sitting on bricks wearing untied boots.">&#60/img></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>        &#60img slot="after"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>            src="https://images.unsplash.com/photo-1520640023173-50a135e35804"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>            alt="A person sitting on a yellow curb tying shoelaces on a boot.">&#60/img></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    &#60/sl-image-comparer></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk10>    """</span></span></span></code></pre><blockquote><p>Latest Fable.Core provides <code>JSX.html</code> helper. This is an alias of <code>JSX.jsx</code> but it's useful if you're using the <a href="https://marketplace.visualstudio.com/items?itemName=alfonsogarciacaro.vscode-template-fsharp-highlight">F# Template Highlighting</a> VS Code extension and you prefer to identify the embededded language as HTML rather than JSX.</blockquote><p>If you want to try Solid but still prefer F# for UIs, <a href=https://github.com/fable-compiler/Feliz.JSX>Feliz.JSX.Solid</a> provides a Feliz-like API for that. And you can freely combine both approaches:<pre class="atom-one-light grvsc-container"data-index=3 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60JSX.Component>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>QrCode</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    importSideEffects </span><span class=mtk10>"https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.73/dist/components/qr-code/qr-code.js"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>value</span><span class=mtk14>,</span><span class=mtk1> setValue </span><span class=mtk14>=</span><span class=mtk1> Solid.createSignal</span><span class=mtk14>(</span><span class=mtk10>"https://shoelace.style/"</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Html.fragment </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Html.input </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Attr.className </span><span class=mtk10>"input mb-5"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Attr.typeText</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Attr.autoFocus </span><span class=mtk6>true</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Attr.value </span><span class=mtk14>(</span><span class=mtk1>value</span><span class=mtk14>())</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            Ev.onTextChange setValue</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        Html.div </span><span class=mtk14>[</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            JSX.html $</span><span class=mtk10>"""&#60sl-qr-code value={value()} radius="0.5">&#60/sl-qr-code>"""</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>]</span></span></span></code></pre><br><p>Likewise, if you want to try Solid but prefer to use Elmish to manage state, Elmish.Solid has you covered. Similarly to <a href=2022-10-13-use-elmish.html>useElmish</a>, <code>createElmishStore</code> allows you to use Elmish at the component level, but it takes advantage of <a href=https://www.solidjs.com/tutorial/stores_nested_reactivity>Solid stores</a> to compare the model snapshots and update only the updated parts. Check how the classic Elmish TodoMVC is rendered with Solid, in <a href=https://github.com/fable-compiler/Fable.Solid/blob/master/src/App/TodoElmish.fs>this example</a>.<blockquote><p>For Solid store diffing to work best, you should use <strong>arrays</strong> (instead of, say, lists or sets) for collections that correspond with on-screen elements.</blockquote><hr><p>One particular feature of <code>createElmishStore</code> is that it can keep state with <a href>Vite hot reload</a>. I say "particular" because, at the time of writing, there's no equivalent of React's Fast Refresh and Solid primitive signals won't keep state while hot reloading. How is it possible to get better tooling with Fable/F# than with native JS? We will talk about this in the next post.</div></div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>
<html class="has-navbar-fixed-top" lang="en"><head><title>Fable Â· Better Typed than Sorry</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item is-hidden-mobile" href="/packages/">Packages</a><a class="navbar-item is-hidden-mobile" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item is-hidden-mobile" href="/community.html">Community</a><a class="navbar-item is-hidden-mobile" href="/resources.html">Resources</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/packages/">Packages</a><a class="nacara-navbar-menu-item" href="/repl/">Try</a><a class="nacara-navbar-menu-item" href="/community.html">Community</a><a class="nacara-navbar-menu-item" href="/resources.html">Resources</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/fable">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a><a class="nacara-navbar-menu-item" href="https://gitter.im/fable-compiler/Fable">Gitter</a><a class="nacara-navbar-menu-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos">Youtube</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/alfonsogarciacaro.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Better Typed than Sorry</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://github.com/alfonsogarciacaro">Alfonso GarcÃ­a-Caro</a><span class="tag is-rounded is-medium">April 20, 2023</span></div><div class="content"><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtki{font-style:italic}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .mtk4{color:#c18401}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .mtk8{color:#0184bc}.atom-one-light .mtk7{color:#a0a1a7}.atom-one-light .mtk6{color:#986801}.atom-one-light .mtk15{color:#ca1243}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><p>If you are a Fable user you may have noticed that we released, quite quietly, Fable 4 a few weeks ago. For existing F# to JS projects, Fable 4 brings exciting new features like dotnet 7 and <a href=../2022/2022-10-12-react-jsx.html>JSX</a> support, but most importantly Fable 4 takes F# beyond JS with the addition of new targets like <a href=../2022/2022-06-06-Snake_Island_alpha.html>Python, Rust or Dart</a>. Though the new major release didn't mean all targets are ready for production, as <a href=../2022/2022-09-28-fable-4-theta.html#language-status>we discussed in a previous post</a>, we have decided to keep a single tool but let each language evolve at its own pace.<blockquote><p>If you haven't upgraded yet, we recommend you do it soon: there are no breaking changes and you <a href=../2022/2022-09-28-fable-4-theta.html#packages-updated-for-fable-4>only need to update a few packages</a>.</blockquote><p>With Fable 4.1 we are happy to announce one of those targets is ready for prime-time! Thanks to the work of <a href=https://github.com/ncave>ncave</a> who has been leading the effort to add type annotations to JS output (in spite of my initial reluctance) for a long time, TypeScript compilation started to become a real possibility. We have been working together in the last month and TypeScript generated code is almost on par now with JS so we have decided to bump the status from beta to stable ðŸš€<p>Wait a moment, compiling to TypeScript? Does this mean I should compile all my JS apps to TypeScript from now on for extra type-safety? No, we don't recommend that. In fact, you probably shouldn't. Many Fable libraries already emit JS code that TypeScript may not accept happily and we cannot control that. TypeScript compilation is intended for integrating F# into existing TypeScript and to write libraries that can be published to npm and consumed with a type-safe API. This is in line with the focus we are giving to the new language targets: instead of trying to do everything in F#, we will concentrate our efforts on having a great experience with <a href=https://fsharpforfunandprofit.com/ddd/>Domain Programming</a> in all platforms. This means spending less time writing bindings for native libraries and instead working on generating nice code that can be easily consumed.<blockquote><p>All-F# frontend apps will still be supported for JS compilation, and it's also possible for contributors to extend Fable for Python/Rust/Dart to support all-F# projects (writing bindings or providing templates and tutorials, etc).</blockquote><p>As always, the best way to understand what TypeScript compilation can do for you is to get your hands on a project, and there's no better one than <a href=https://compostjs.github.io/compost/>compostjs</a>, another great library from <a href=https://tomasp.net/>Tomas Petricek</a> to create charts through composition. Compostjs is written in F#, compiled to JS and published to npm. It already offers a nice and <a href=https://compostjs.github.io/compost/api.html>documented API</a>. But the IDE experience is not that great, because the type information was missing in the compilation... until now. <a href=https://github.com/alfonsogarciacaro/compost/>This fork</a> adapts compostjs to be compiled to TypeScript with Fable 4.1, and it also enables fluent APIs that are self-discoverable and can be type-checked also for TS/JS consumers!</p><img src=./compost-typed.webp style="max-width:50rem;margin:2rem auto;display:block"><p>If you want to try it out, clone <a href=https://github.com/alfonsogarciacaro/compost/>the fork</a> and run the following commands:<pre class="atom-one-light grvsc-container"data-index=0 data-language=bash><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>dotnet tool restore</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>npm install</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>npm start</span></span></span></code></pre><p>Then you can open <code>src\project\App.tsx</code>, edit the code and see the changes in the browser and how the IDE will guide you and warn of potential mistakes.<h2 id=how-to-expose-a-nice-typescript-api>How to expose a nice TypeScript API<a href=#how-to-expose-a-nice-typescript-api aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h2><p>The mechanisms to expose a nice API are the same as <a href=https://fable.io/docs/communicate/js-from-fable.html#type-safety-with-imports-and-interfaces>when consuming JS code from F#</a>. First, use <strong>interfaces</strong> to define the contracts between F# and native code. This is because Fable by default won't mangle interfaces. You can use interfaces when <a href=https://github.com/alfonsogarciacaro/compost/blob/e783ed687bc19887f02aa0b071585a1a152c8956/src/compost/compost.fs#L80-L110>exporting</a>, <a href=https://github.com/alfonsogarciacaro/compost/blob/e783ed687bc19887f02aa0b071585a1a152c8956/src/compost/compost.fs#L203-L226>creating a fluent API</a> or declaring <a href=https://github.com/alfonsogarciacaro/compost/blob/e783ed687bc19887f02aa0b071585a1a152c8956/src/compost/compost.fs#L14-L22>complex arguments</a> (this is particularly useful for dependencies that need to be injected from native code):<pre class="atom-one-light grvsc-container"data-index=1 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Browser.Types</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> U2</span><span class=mtk14>&lt;</span><span class=mtk1>float</span><span class=mtk14>,</span><span class=mtk1> obj </span><span class=mtk14>*</span><span class=mtk1> float</span><span class=mtk14>></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Point</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> Coord </span><span class=mtk14>*</span><span class=mtk1> Coord</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Handlers</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> mousedown</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>MouseEvent</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>unit</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk4>option</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> mouseup</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>MouseEvent</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>unit</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk4>option</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> mousemove</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>MouseEvent</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>unit</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk4>option</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>CompostShape</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> on </span><span class=mtk14>:</span><span class=mtk1> handlers</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Handlers</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>CompostShape</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Compost</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>..</span><span class=mtk1>.</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>interface</span><span class=mtk1> CompostShape </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>member</span><span class=mtk1> </span><span class=mtk5>s.on</span><span class=mtk14>(</span><span class=mtk1>h</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Handlers</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      Shape.Interactive</span><span class=mtk14>([</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> h.mousedown </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> None </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Some f </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>yield</span><span class=mtk1> MouseDown</span><span class=mtk14>(fun</span><span class=mtk1> me </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>,</span><span class=mtk1> y</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> f </span><span class=mtk14>(</span><span class=mtk1>formatValue x</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>formatValue y</span><span class=mtk14>)</span><span class=mtk1> me</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> h.mouseup </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> None </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Some f </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>yield</span><span class=mtk1> MouseUp</span><span class=mtk14>(fun</span><span class=mtk1> me </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>,</span><span class=mtk1> y</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> f </span><span class=mtk14>(</span><span class=mtk1>formatValue x</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>formatValue y</span><span class=mtk14>)</span><span class=mtk1> me</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>match</span><span class=mtk1> h.mousemove </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> None </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>|</span><span class=mtk1> Some f </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>yield</span><span class=mtk1> MouseMove</span><span class=mtk14>(fun</span><span class=mtk1> me </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>,</span><span class=mtk1> y</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> f </span><span class=mtk14>(</span><span class=mtk1>formatValue x</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>formatValue y</span><span class=mtk14>)</span><span class=mtk1> me</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      </span><span class=mtk14>],</span><span class=mtk1> s</span><span class=mtk14>)</span></span></span></code></pre><p>Because all <code>Handlers</code> fields are optional, the method can be called from JS/TS passing only a number of them:<pre class="atom-one-light grvsc-container"data-index=2 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>c.</span><span class=mtk9>line</span><span class=mtk1>(data)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    .</span><span class=mtk9>strokeColor</span><span class=mtk1>(</span><span class=mtk10>"#202020"</span><span class=mtk1>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    .</span><span class=mtk9>on</span><span class=mtk1>({</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk9>mousedown</span><span class=mtk8>:</span><span class=mtk1> (x, y) </span><span class=mtk14>=></span><span class=mtk1> </span><span class=mtk4>console</span><span class=mtk1>.</span><span class=mtk8>log</span><span class=mtk1>(</span><span class=mtk10>"CLICK!"</span><span class=mtk1>, x, y)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    })</span></span></span></code></pre><blockquote><p>A similar effect can be achieved with <a href=https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/anonymous-records>anonymous records</a>.</blockquote><h3 id=exporting-members>Exporting members<a href=#exporting-members aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>A disadvantage of exporting an object expression is it won't play well with <a href=https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking>tree shaking</a>, so you can use a plain module instead. Just make sure there is only <strong>one single root module</strong> in the file to prevent automatic mangling:<pre class="atom-one-light grvsc-container"data-index=3 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// It doesn't matter if the module is nested in a namespace</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> MyNamespace.MyModule</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>add</span><span class=mtk1> x y </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>+</span><span class=mtk1> y</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>multiply</span><span class=mtk1> x y </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>*</span><span class=mtk1> y</span></span></span></code></pre><p>This method is not perfect either because F# module methods cannot have optional arguments. If you need them you can use an erased static class with <code>Mangle(false)</code> attribute.<pre class="atom-one-light grvsc-container"data-index=4 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>namespace</span><span class=mtk9> MyNamespace</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60Erase</span><span class=mtk14>;</span><span class=mtk8> Mangle</span><span class=mtk14>(</span><span class=mtk6>false</span><span class=mtk14>)</span><span class=mtk8>>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>MyClass</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>static member</span><span class=mtk1> </span><span class=mtk5>add</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>y</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>+</span><span class=mtk1> defaultArg y </span><span class=mtk6>0</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>static member</span><span class=mtk1> </span><span class=mtk5>multiply</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>y</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>*</span><span class=mtk1> defaultArg y </span><span class=mtk6>1</span></span></span></code></pre><p>The produced JS/TS code is the same as with the module above (except for the optional arguments). As with interfaces, in this case overloads cannot be used and you also need to be careful to avoid name conflicts.<h3 id=erased-unions>Erased unions<a href=#erased-unions aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Precisely, because overloads are not supported in JS, TypeScript often uses what we call <em>erased</em> unions (to tell them apart from <em>actual</em> F# unions) to allow different types of arguments. Fable can <a href=https://fable.io/docs/communicate/js-from-fable.html#erase-attribute>represent these in F#</a> with unions decorated with <code>Erase</code> attribute. You can expose them in your APIs and even use pattern matching, but be aware this is translated to standard JS runtime testing (<code>typeof</code>, <code>instanceof</code>, <code>Array.isArray</code>...) so only use erased unions with <a href=https://fable.io/docs/dotnet/compatibility.html#net-base-class-library>distinct JS primitives</a> (e.g. no <code>U2&#60int, float></code>).<pre class="atom-one-light grvsc-container"data-index=5 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Fable.Core.JsInterop</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> U2</span><span class=mtk14>&lt;</span><span class=mtk1>float</span><span class=mtk14>,</span><span class=mtk1> obj </span><span class=mtk14>*</span><span class=mtk1> float</span><span class=mtk14>></span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk14>private</span><span class=mtk1> </span><span class=mtk5>formatValue</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>v</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Value</span><span class=mtk14>):</span><span class=mtk1> </span><span class=mtk4>Coord </span><span class=mtk14>=</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>match</span><span class=mtk1> v </span><span class=mtk14>with</span><span class=mtk1> </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>|</span><span class=mtk1> COV</span><span class=mtk14>(</span><span class=mtk1>CO v</span><span class=mtk14>)</span><span class=mtk1>    </span><span class=mtk14>-></span><span class=mtk1> U2.Case1</span><span class=mtk14>(</span><span class=mtk1>v</span><span class=mtk14>)</span><span class=mtk1>    </span><span class="mtk7 mtki">// or ^!v</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>|</span><span class=mtk1> CAR</span><span class=mtk14>(</span><span class=mtk1>CA c</span><span class=mtk14>,</span><span class=mtk1> r</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> U2.Case2</span><span class=mtk14>(</span><span class=mtk1>c</span><span class=mtk14>,</span><span class=mtk1> r</span><span class=mtk14>)</span><span class=mtk1> </span><span class="mtk7 mtki">// or ^!(c, r)</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk14>private</span><span class=mtk1> </span><span class=mtk5>parseValue</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>v</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Coord</span><span class=mtk14>):</span><span class=mtk1> </span><span class=mtk4>Value </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>match</span><span class=mtk1> v </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>|</span><span class=mtk1> U2.Case1 v </span><span class=mtk14>-></span><span class=mtk1> COV</span><span class=mtk14>(</span><span class=mtk1>CO</span><span class=mtk14>(</span><span class=mtk1>v</span><span class=mtk14>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>|</span><span class=mtk1> U2.Case2 </span><span class=mtk14>(</span><span class=mtk1>a1</span><span class=mtk14>,</span><span class=mtk1> a2</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> CAR</span><span class=mtk14>(</span><span class=mtk1>CA</span><span class=mtk14>(</span><span class=mtk1>string a1</span><span class=mtk14>),</span><span class=mtk1> a2</span><span class=mtk14>)</span></span></span></code></pre><p>Even if the declaration is erased the correct type is shown for the return and argument types in TypeScript:<pre class="atom-one-light grvsc-container"data-index=6 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>function</span><span class=mtk1> </span><span class=mtk9>formatValue</span><span class=mtk1>(v</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>Value_$union</span><span class=mtk1>)</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>|</span><span class=mtk1> [</span><span class=mtk8>any</span><span class=mtk1>, </span><span class=mtk4>float64</span><span class=mtk1>] {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>if</span><span class=mtk1> (v.</span><span class=mtk5>tag</span><span class=mtk1> </span><span class=mtk8>===</span><span class=mtk1> </span><span class="mtk7 mtki">/* CAR */</span><span class=mtk1> </span><span class=mtk6>0</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>r</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>1</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>c</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>string</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>].</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> [c, r] as [</span><span class=mtk8>any</span><span class=mtk1>, </span><span class=mtk4>float64</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>else</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>v_1</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>].</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> v_1;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>function</span><span class=mtk1> </span><span class=mtk9>parseValue</span><span class=mtk1>(v</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>|</span><span class=mtk1> [</span><span class=mtk8>any</span><span class=mtk1>, </span><span class=mtk4>float64</span><span class=mtk1>])</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>Value_$union</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>if</span><span class=mtk1> (</span><span class=mtk9>isArrayLike</span><span class=mtk1>(v)) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>a2</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v[</span><span class=mtk6>1</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>a1</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>any</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v[</span><span class=mtk6>0</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk9>Value_CAR</span><span class=mtk1>(</span><span class=mtk14>new</span><span class=mtk1> </span><span class=mtk4>categorical</span><span class=mtk1>(</span><span class=mtk9>toString</span><span class=mtk1>(a1)), a2);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>else</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>v_1</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> v;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk9>Value_COV</span><span class=mtk1>(</span><span class=mtk14>new</span><span class=mtk1> </span><span class=mtk4>continuous</span><span class=mtk1>(v_1));</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><h3 id=named-arguments>Named arguments<a href=#named-arguments aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>While JS/TS accept optional arguments, they cannot be omitted unless they are at the end position. Because of this, it is common to pass a dictionary object instead (as with Python). In Fable you could use the <code>NamedParams</code> to represent this situation in bindings, and now you can also use it when declaring your own APIs:<pre class="atom-one-light grvsc-container"data-index=7 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>CompostShape</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk8>[&#60NamedParams>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> axes</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>top</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>right</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>bottom</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>left</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>bool</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>CompostShape</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class="mtk7 mtki">// If there are positional arguments too, indicate where the named arguments start</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk8>[&#60NamedParams</span><span class=mtk14>(</span><span class=mtk8>fromIndex</span><span class=mtk14>=</span><span class=mtk6>1</span><span class=mtk14>)</span><span class=mtk8>>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>abstract</span><span class=mtk1> mixMethod</span><span class=mtk14>:</span><span class=mtk1> positionalArg</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>float</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>namedArg1</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk14>?</span><span class=mtk1>namedArg2</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk4>unit</span></span></span></code></pre><p>This can be consumed from TypeScript like:<pre class="atom-one-light grvsc-container"data-index=8 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>shape.</span><span class=mtk9>axes</span><span class=mtk1>({ </span><span class=mtk5>right</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk1>, </span><span class=mtk5>bottom</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk1>, </span><span class=mtk5>left</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk1> }) </span><span class="mtk7 mtki">// ok</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>shape.</span><span class=mtk9>axes</span><span class=mtk1>({ </span><span class=mtk5>top</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk10>"false"</span><span class=mtk1> }) </span><span class="mtk7 mtki">// TS error, wrong type</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>shape.</span><span class=mtk9>axes</span><span class=mtk1>({ </span><span class=mtk5>vertical</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>true</span><span class=mtk1> }) </span><span class="mtk7 mtki">// TS error, wrong name</span></span></span></code></pre><h3 id=f-unions-in-typescript>F# Unions in TypeScript<a href=#f-unions-in-typescript aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>We'll finish this post talking about another interesting feature of the TypeScript compilation. Besides <em>erased</em> unions you can also expose <em>actual</em> F# unions and even do pattern matching in TypeScript! This is because Fable uses TypeScript literal types to annotate the unions with their tag. Given an example like this:<pre class="atom-one-light grvsc-container"data-index=9 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Foo </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>string</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Bar </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>float</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Baz</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>test</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>x</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>match</span><span class=mtk1> x </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Foo </span><span class=mtk14>(_,</span><span class=mtk1> b</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> b.ToUpperInvariant</span><span class=mtk6>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Bar a </span><span class=mtk14>-></span><span class=mtk1> a </span><span class=mtk14>+</span><span class=mtk1> </span><span class=mtk6>5.3</span><span class=mtk1> </span><span class=mtk14>|></span><span class=mtk1> sprintf </span><span class=mtk10>"</span><span class=mtk14>%f</span><span class=mtk10>"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Baz </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk10>"Baz"</span></span></span></code></pre><p>If you inspect the generated code, you will see how Fable generates extra types in TypeScript for each union:<pre class="atom-one-light grvsc-container"data-index=10 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>MyUnion_$union</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk1>&lt;</span><span class=mtk6>0</span><span class=mtk1>> </span><span class=mtk8>|</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk1>&lt;</span><span class=mtk6>1</span><span class=mtk1>> </span><span class=mtk8>|</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk1>&lt;</span><span class=mtk6>2</span><span class=mtk1>>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>MyUnion_$cases</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> { </span><span class=mtk6>0</span><span class=mtk8>:</span><span class=mtk1> [</span><span class=mtk10>"Foo"</span><span class=mtk1>, [</span><span class=mtk8>string</span><span class=mtk1>, </span><span class=mtk8>string</span><span class=mtk1>]], </span><span class=mtk6>1</span><span class=mtk8>:</span><span class=mtk1> [</span><span class=mtk10>"Bar"</span><span class=mtk1>, [</span><span class=mtk4>float64</span><span class=mtk1>]], </span><span class=mtk6>2</span><span class=mtk8>:</span><span class=mtk1> [</span><span class=mtk10>"Baz"</span><span class=mtk1>, []] };</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>class</span><span class=mtk1> </span><span class=mtk4>MyUnion</span><span class=mtk1>&lt;</span><span class=mtk4>Tag</span><span class=mtk1> </span><span class=mtk14>extends</span><span class=mtk1> </span><span class=mtk8>keyof</span><span class=mtk1> </span><span class=mtk4>MyUnion_$cases</span><span class=mtk1>> </span><span class=mtk14>extends</span><span class=mtk1> </span><span class=mtk4>Union</span><span class=mtk1>&lt;</span><span class=mtk4>Tag</span><span class=mtk1>, </span><span class=mtk4>MyUnion_$cases</span><span class=mtk1>[</span><span class=mtk4>Tag</span><span class=mtk1>][</span><span class=mtk6>0</span><span class=mtk1>]> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>constructor</span><span class=mtk1>(</span><span class=mtk14>readonly</span><span class=mtk1> tag</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>Tag</span><span class=mtk1>, </span><span class=mtk14>readonly</span><span class=mtk1> fields</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>MyUnion_$cases</span><span class=mtk1>[</span><span class=mtk4>Tag</span><span class=mtk1>][</span><span class=mtk6>1</span><span class=mtk1>]) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk5>super</span><span class=mtk1>();</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk9>cases</span><span class=mtk1>() {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> [</span><span class=mtk10>"Foo"</span><span class=mtk1>, </span><span class=mtk10>"Bar"</span><span class=mtk1>, </span><span class=mtk10>"Baz"</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>function</span><span class=mtk1> </span><span class=mtk9>test</span><span class=mtk1>(x</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>MyUnion_$union</span><span class=mtk1>)</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>string</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// Here the types of `fields` are still unknown</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>switch</span><span class=mtk1> (x.</span><span class=mtk5>tag</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>case</span><span class=mtk1> </span><span class="mtk7 mtki">/* Foo */</span><span class=mtk1> </span><span class=mtk6>0</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// Here TypeScript knows that `fields` is a tuple of two strings</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>b</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>string</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> x.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>1</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>return</span><span class=mtk1> b.</span><span class=mtk9>toUpperCase</span><span class=mtk1>();</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>case</span><span class=mtk1> </span><span class="mtk7 mtki">/* Bar */</span><span class=mtk1> </span><span class=mtk6>1</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// If you hover over `x` within this branch, you'll see</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class="mtk7 mtki">// `MyUnion_$union` type has collapsed to `MyUnion&lt;1>`</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>a</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> x.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk9>toText</span><span class=mtk1>(</span><span class=mtk9>printf</span><span class=mtk1>(</span><span class=mtk10>"%f"</span><span class=mtk1>))(a </span><span class=mtk8>+</span><span class=mtk1> </span><span class=mtk6>5.3</span><span class=mtk1>);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// If you comment out any of the cases or use a number outside</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class="mtk7 mtki">// the tag range, TypeScript will complain</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>case</span><span class=mtk1> </span><span class="mtk7 mtki">/* Baz */</span><span class=mtk1> </span><span class=mtk6>2</span><span class=mtk1>:</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk10>"Baz"</span><span class=mtk1>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><blockquote><p>The extra types are just aliases that only exists in TypeScript, so they won't have any effect in the runtime.</blockquote><p>A switch against a number is very fast. TypeScript consumers, however, may find it more convenient to match against the name. They can do it with the same level of type safety:<pre class="atom-one-light grvsc-container"data-index=11 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>switch</span><span class=mtk1> (x.</span><span class=mtk5>name</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>case</span><span class=mtk1> </span><span class=mtk10>"Foo"</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>b</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>string</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> x.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>1</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> b.</span><span class=mtk9>toUpperCase</span><span class=mtk1>();</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>case</span><span class=mtk1> </span><span class=mtk10>"Bar"</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk6>a</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>float64</span><span class=mtk1> </span><span class=mtk8>=</span><span class=mtk1> x.</span><span class=mtk5>fields</span><span class=mtk1>[</span><span class=mtk6>0</span><span class=mtk1>];</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk9>toText</span><span class=mtk1>(</span><span class=mtk9>printf</span><span class=mtk1>(</span><span class=mtk10>"%f"</span><span class=mtk1>))(a </span><span class=mtk8>+</span><span class=mtk1> </span><span class=mtk6>5.3</span><span class=mtk1>);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>case</span><span class=mtk1> </span><span class=mtk10>"Baz"</span><span class=mtk1>:</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk10>"Baz"</span><span class=mtk1>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><p>Same as with tags, TypeScript will check you are using the correct case names, whether the switch is comprehensive and the correct <code>fields</code> types within each branch.<p>This is not the only convenience that Fable TypeScript compilation offers. When you need to instantiate an F# union from TS it's cumbersome to use the tag as a generic argument, so convenience helpers are offered as constructors for each case:<pre class="atom-one-light grvsc-container"data-index=12 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk9>test</span><span class=mtk1>(</span><span class=mtk9>MyUnion_Foo</span><span class=mtk1>(</span><span class=mtk10>"a"</span><span class=mtk1>, </span><span class=mtk10>"b"</span><span class=mtk1>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk9>test</span><span class=mtk1>(</span><span class=mtk9>MyUnion_Bar</span><span class=mtk1>(</span><span class=mtk6>5</span><span class=mtk1>))</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk9>test</span><span class=mtk1>(</span><span class=mtk9>MyUnion_Baz</span><span class=mtk1>())</span></span></span></code></pre><h3 id=typescript-tagged-unions>TypeScript Tagged Unions<a href=#typescript-tagged-unions aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Even if F# unions can be used in a typed-safe manner from TypeScript, when you build a public API you may want your unions to feel more "native". And it happens that TypeScript does have the concept of a <a href=https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-func.html#discriminated-unions>discriminated union</a>: which is a union of JS objects where all of them share a common property that has the function of the "tag". Fable can compile F# unions to TypeScript tagged unions thanks to the <code>TypeScriptTaggedUnion</code> attribute. This was a feature contributed by <a href=https://github.com/cannorin>cannorin</a> and since <strong>Fable 4.1.3</strong> it has been updated to support TypeScript annotations. You define the name of the tag property in the attribute, and the name of each case will become the value of the tag. It is also important that you use <strong>named fields</strong> for each case. Let's see an example:<pre class="atom-one-light grvsc-container"data-index=13 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60TypeScriptTaggedUnion</span><span class=mtk14>(</span><span class=mtk10>"type"</span><span class=mtk14>)</span><span class=mtk8>>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Command</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Take </span><span class=mtk14>of</span><span class=mtk1> fromIndex</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>*</span><span class=mtk1> toIndex</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>int</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Edit </span><span class=mtk14>of</span><span class=mtk1> text</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Save</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>test</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>function</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Take</span><span class=mtk14>(</span><span class=mtk1>fromIndex</span><span class=mtk14>,</span><span class=mtk1> toIndex</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> printfn $</span><span class=mtk10>"Taking from {fromIndex} to {toIndex}"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Edit</span><span class=mtk14>(</span><span class=mtk1>text</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>-></span><span class=mtk1> printfn $</span><span class=mtk10>"New text: {text}"</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Save </span><span class=mtk14>-></span><span class=mtk1> printfn </span><span class=mtk10>"Saving"</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>Take</span><span class=mtk14>(</span><span class=mtk6>5</span><span class=mtk14>,</span><span class=mtk1> </span><span class=mtk6>7</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>|></span><span class=mtk1> test</span></span></span></code></pre><p>In TypeScript it becomes:<pre class="atom-one-light grvsc-container"data-index=14 data-language=ts><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Command</span><span class=mtk1> </span><span class=mtk8>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk8>|</span><span class=mtk1> { type</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk10>"take"</span><span class=mtk1>, fromIndex</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>int32</span><span class=mtk1>, toIndex</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>int32</span><span class=mtk1> }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk8>|</span><span class=mtk1> { type</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk10>"edit"</span><span class=mtk1>, text</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>string</span><span class=mtk1> }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk8>|</span><span class=mtk1> { type</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk10>"save"</span><span class=mtk1> }</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>export</span><span class=mtk1> </span><span class=mtk14>function</span><span class=mtk1> </span><span class=mtk9>test</span><span class=mtk1>(arg</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk4>Command</span><span class=mtk1>)</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk8>void</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>switch</span><span class=mtk1> (arg.</span><span class=mtk5>type</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>case</span><span class=mtk1> </span><span class=mtk10>"edit"</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk9>toConsole</span><span class=mtk1>(</span><span class=mtk10>`New text: </span><span class=mtk15>${</span><span class=mtk1>arg</span><span class=mtk10>.</span><span class=mtk5>text</span><span class=mtk15>}</span><span class=mtk10>`</span><span class=mtk1>);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>break</span><span class=mtk1>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>case</span><span class=mtk1> </span><span class=mtk10>"save"</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk9>toConsole</span><span class=mtk1>(</span><span class=mtk9>printf</span><span class=mtk1>(</span><span class=mtk10>"Saving"</span><span class=mtk1>));</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>break</span><span class=mtk1>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        </span><span class=mtk14>default</span><span class=mtk1>: {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk9>toConsole</span><span class=mtk1>(</span><span class=mtk10>`Taking from </span><span class=mtk15>${</span><span class=mtk1>arg</span><span class=mtk10>.</span><span class=mtk5>fromIndex</span><span class=mtk15>}</span><span class=mtk10> to </span><span class=mtk15>${</span><span class=mtk1>arg</span><span class=mtk10>.</span><span class=mtk5>toIndex</span><span class=mtk15>}</span><span class=mtk10>`</span><span class=mtk1>);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk9>test</span><span class=mtk1>({</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>type</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk10>"take"</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>fromIndex</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>5</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>toIndex</span><span class=mtk8>:</span><span class=mtk1> </span><span class=mtk6>7</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>});</span></span></span></code></pre><p>By default the case names will change to camel case, but as with <code>StringEnum</code> you can pass a <code>CaseRules</code> argument to the attribute to control this, as well as using <code>CompiledName</code> in a case:<pre class="atom-one-light grvsc-container"data-index=15 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60TypeScriptTaggedUnion</span><span class=mtk14>(</span><span class=mtk10>"method"</span><span class=mtk14>,</span><span class=mtk8> CaseRules.SnakeCaseAllCaps</span><span class=mtk14>)</span><span class=mtk8>>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>HttpOptions</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Get</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Post </span><span class=mtk14>of</span><span class=mtk1> body</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> Put </span><span class=mtk14>of</span><span class=mtk1> body</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> </span><span class=mtk8>[&#60CompiledName</span><span class=mtk14>(</span><span class=mtk10>"HEAD"</span><span class=mtk14>)</span><span class=mtk8>>]</span><span class=mtk1> OnlyHeaders</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// TypeScript:</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">//</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">// type HttpOptions =</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">//     | { method: "GET" }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">//     | { method: "POST", body: string }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">//     | { method: "PUT", body: string }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class="mtk7 mtki">//     | { method: "HEAD" }</span></span></span></code></pre><article class="is-warning message"><div class=message-body><div><p>Types decorated with <code>TypeScriptTaggedUnion</code> have similar limitations to <code>Erase</code> and <code>StringEnum</code>, that is, because the type has no actual representation in the JS runtime, you cannot use reflection, do type testing or attach interfaces (you can still use instance and static members from F#). It is recommended to use the special attributes only to interact with native code and not in your everyday F# programming.</div></div></article><h2 id=compilation-options>Compilation options<a href=#compilation-options aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h2><p>In order to compile to TypeScript, you only need to pass the <code>--lang ts</code> option to Fable tool, but let's have a look at <a href=https://github.com/alfonsogarciacaro/compost/blob/e783ed687bc19887f02aa0b071585a1a152c8956/package.json#L7-L11>the extra options in the compostjs example</a>:<pre class="atom-one-light grvsc-container"data-index=16 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>dotnet fable src/compost -o src/compost-ts --lang ts --fableLib fable-library --noReflection</span></span></code></pre><ul><li><code>--fableLib fable-library</code>: So far, Fable has been embedding the library files in each project, but from now on we are also <a href=https://www.npmjs.com/package/fable-library>distributing it through npm</a>. By using this compiler option you can tell Fable to use the npm package instead of the embedded files. This is is particularly useful if a consumer installs two or more libraries compiled with Fable, to avoid duplication of the library files.</ul><blockquote><p>Since Fable 4.1.2, when the tool starts, after printing the compiler version it will also tell you the minimum fable-library version compatible with the generated code.</blockquote><ul><li><code>--noReflection</code>: By default Fable emits helpers for each declared type containing reflection information. These are used, for example, when generating <a href=https://thoth-org.github.io/Thoth.Json/documentation/auto/introduction.html>auto coders with Thoth.Json</a>. You don't need to care much about them because if not used they will be removed by tree shaking. But if you are not using reflection you can select this option to reduce the amount of generated code.</ul><p>If publishing the library to npm, you will also need an extra step to compile the TypeScript code to JavaScript and generate the declaration files. You can use the TypeScript compiler for that like follows:<pre class="atom-one-light grvsc-container"data-index=17 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>npm run fable &#38&#38 tsc --outDir ./dist --declaration --noEmit false</span></span></code></pre><p>In most situations you will also need a <a href=https://www.typescriptlang.org/docs/handbook/tsconfig-json.html>tsconfig.json file</a>. You can use <a href=https://github.com/alfonsogarciacaro/compost/blob/e783ed687bc19887f02aa0b071585a1a152c8956/tsconfig.json>the one in the compostjs example</a> as reference.</p><br><hr><br><p>That was it! There are still a few things missing in TypeScript compilation, but we believe it's already in a state that will let you integrate F# in TypeScript projects and/or write npm libraries in F# with confidence. We hope you find it useful and we are looking forward for all the great things you are going to build with F# and Fable. Make sure to let us know!</div></div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>